prompt

「請在程式碼開頭保留 ChatGPT Prompt 紀錄」

「使用台灣繁體中文」

「不要動到其他欄位公式」

  「要用在 Apps Script」
  
  
  只要是 J 欄為 IT 或 XX 開頭的都要拆解（支援多種分隔符號），
 *     然後把拆解後各需求單號在目標表加總的耗時（D，不去重）再「總加總」，
 *     回寫至 年度專案_預估工時.AI（總時數）及 年度專案_預估工時.AJ（總天數）
 
 回寫到來源該列的 W ~ AG，欄位對應依「來源第 2 列 W ~ AG 的表頭文字」= 角色名稱


 * 【ChatGPT Prompt 紀錄｜實際產出作法】
 
  * 【不要動到其他欄位公式】
 
  * 【 Apps Script 規則】
 

來源表：耗用工時_2025

比對表：

寫入結果：


////總件數___03_各部室專案耗用工時
/**
 * 來源表：耗用工時_2025
 * - 依 申請單位（D 欄） + 專案(A欄) 前10碼且以 "IT" 開頭 分組
 * - 件數：同一 (申請單位 + IT10) 只算 1 件（去重計件）
 * - 但當 J欄為「資訊系統維運工作」或「SE維運工作」時，不計入件數
 
 * 目標表：03_各部室專案耗用工時
 * - 只處理「序（B 欄）為數字」的資料列
 * - 比對 申請部門（C 欄），字串完全一致（不 trim、不轉換）
 * - 寫入 D 欄（需求單總數）
 *   寫入前：先清空 D 欄（只清 B 為數字的列）
 *
 * 額外：
 * - 完全比對不到的來源部門(申請單位D)：
 *   列印出j申請單位（D 欄） + 專案(A欄)
 *   並輸出到工作表 X_Error
 */
 
 
 


///總件數:02_各專案類型耗時統計

/**
 * 來源表：耗用工時_2025
 * - 取 專案(A欄) 前10碼，且以 "IT" 開頭
 * - 以前10碼為單位計件（同一前10碼只算 1 件）
 * - 只加總「A欄(專案)以 IT 開頭」的件數（= 去重後專案數）
 *   但當 J欄為「資訊系統維運工作」或「SE維運工作」時，不計入件數
 
 *
 * 比對表：02_各專案類型耗時統計
 * - 只處理「序(B欄)為數字」的資料列
 * - 當 02.C == 耗用工時_2025.J（字串完全一致、不 trim、不轉換）
 * - 將件數寫入 02.D
 *   在寫入前：先清空 02.D（只限 B 為數字的列）
 *
 * 額外：
 * - 完全比對不到的：耗用工時_2025.J 不存在於 02.C（限：B為數字的列）
 *   → 輸出到 X_Error（A, J），且 (A,J) 去重
 *
 * 注意：
 * - 字串完全一致（不做 trim、不轉換）
 */


////總天數::02_各專案類型耗時統計

/**
 * 來源表：耗用工時_2025
 * - 依 J欄（最終專案類別）分組
 * - 加總 I欄（耗時）不去重複（逐列加總）
 *
 * 比對表：02_各專案類型耗時統計
 * - 只處理「序（B 欄）為數字」的資料列
 * - 比對 專案類型（C 欄），字串完全一致（不做 trim、不轉換）
 *
 * 寫入結果：
 * - 加總耗時 ÷ 7
 * - 四捨五入到小數點第一位
 * - 寫入 E 欄（總天數）
 *   先將 E 欄（總天數）清空白再寫入（只清 B 為數字列）
 *
 * 額外（輸出明細到 X_Error）：
 * - (1) 專案空白
 * - (2) 耗時(I)非數字
 * - (3) 比對不到的或未列入加總的
 *
 * 注意：
 * - 字串完全一致（不做 trim、不轉換）
 */



///Z_最終體係別
/**Z_最終體係別
 * 來源表：耗用工時_2025
 *
 * 0) 先清空 耗用工時_2025.K欄(最終體係別) 及L欄(最終體係別代碼)
 *
 * 1) 若「專案(A欄)前10碼」以 IT 開頭：
 *    - 回寫專案前三碼(IT3) 至 耗用工時_2025.K欄(最終體係別)
 *
 * 2) 若「專案(A欄)前10碼」不是以 IT 開頭：
 *    - 以「耗用工時_2025.專案(A欄)」對應「Z_設定檔.專案(A欄)」（字串完全一致）
 *    - 命中則取「Z_設定檔.體係別(C欄)前三碼」回寫至 耗用工時_2025.K欄(最終體係別)
 * 3) 以 耗用工時_2025.K欄(最終體係別)去比對 Z_設定檔.K欄(最後體係別)
      對應出Z_設定檔.L欄(最終體係別代碼)
 *
 * 4) 最後列出 耗用工時_2025.K 仍為空白 的「專案(A欄)」資料
 *    -> 輸出到 X_Error + Logger
 *
 * 注意：
 * - 字串完全一致（不做 trim、不轉換）
 */


//////來源表：Z_設定檔

比對表：
耗用工時_2025的專案(A欄)等於 Z_設定檔的專案(A欄)時

寫入結果：
將Z_設定檔的申請單位(B欄)值寫入耗用工時_2025的申請單位(D欄)

如果存在Z_設定檔的專案(A欄)但不存在耗用工時_2025的專案(A欄)則印出來.
但若不存在Z_設定檔的專案(A欄) 則不異動






來源表：耗用工時_2025
統計有
專案(A欄)前10碼且有IT開頭為分組,去除重複的前前10碼

並列印出
1.專案(A欄)前3碼總共件數
2.專案(A欄)前3碼總共件數
2.所有前3碼加總有多少件
2.及明細

03_各部室專案耗用工時

* 來源表：耗用工時_2025
 * - 依 申請單位（D 欄）分組
 * - 加總耗時（I 欄）
 *
 * 比對表：03_各部室專案耗用工時
 * - 只處理「序（B 欄）為數字」的資料列
 * - 比對 申請部門（C 欄），字串完全一致（不做 trim、不轉換）
 *
 * 寫入結果：
 * - 加總耗時 ÷ 7
 * - 四捨五入到小數點第一位
 * - 寫入 E 欄（總天數）
 */

 
 
來源表：耗用工時_2025
依 申請單位（D 欄） 及 專案(A欄)前10碼且有IT開頭 分組
加總申請單位（D 欄） 及 專案(A欄)前10碼且有IT開頭 件數

比對表：03_各部室專案耗用工時
只處理「序（B 欄）為數字」的資料列
比對 申請部門（C 欄），字串完全一致（不做 trim、不轉換）

寫入結果：03_各部室專案耗用工時
加總件數
寫入 D 欄（需求單總數）




/////寫入 D 欄（需求單總數）

來源表：
耗用工時_2025 依 申請單位（D 欄） 及 專案(A欄)前10碼且有IT開頭 分組 
加總申請單位（D 欄） 及 專案(A欄)前10碼且有IT開頭 件數 

比對表：03_各部室專案耗用工時 

只處理「序（B 欄）為數字」的資料列 

比對 申請部門（C 欄），字串完全一致（不做 trim、不轉換） 

寫入結果：03_各部室專案耗用工時 加總件數 寫入 D 欄（需求單總數）

額外:完全比對不到的,請列印出前10碼


//////需求單總件數:01.各體係專案耗時統計

/**
 * 來源表：耗用工時_2025
 
 * - 取 專案(A欄) 前10碼，且以 "IT" 開頭
 * - 以前10碼為單位計件（同一前10碼只算 1 件）
 * - 彙總到前三碼（前10碼的前3碼）
 *   但當 J欄(最終專案類別)為「資訊系統維運工作」或「SE維運工作」時，不計入件數
 *
 * 目標表：01.各體係專案耗時統計
 * - 只處理「序（B 欄）為數字」的列
 * - 當 A欄(前三碼) == 來源前三碼 時，寫入 D 欄（需求單總數）
 *
 * 額外：
 * - 對「完全比對不到」的來源前三碼(it3)，列印出該 it3 底下所有「前10碼」(去重後)
 *   (同時輸出到工作表 Unmatched_IT10_01)
 */


//////總天數:01.各體係專案耗時統計

/**
 * 來源表：耗用工時_2025
 * 1) 若「專案(A欄)前10碼」以 IT 開頭：
 *    - 每一列都要計算（不去重）
 *    - 依「專案前三碼(IT3=前3碼)」彙總耗時(I欄)
 *
 * 2) 若「專案(A欄)前10碼」不是以 IT 開頭：
 *    - 以「耗用工時_2025.專案(A欄)」對應「Z_設定檔.專案(A欄)」
 *    - 僅當 Z_設定檔存在該專案時才納入統計
 *    - 改以「Z_設定檔.體係別(C欄)前三碼」為 key 彙總耗時(I欄)
 *
 * 3) 若「專案(A欄)前10碼」不是以 IT 開頭，且 Z_設定檔也找不到該專案：
 *    - 仍算入 key = "ITG" 彙總耗時(I欄)
 *    - 並列印/輸出明細：說明該專案被算入 ITG、工時多少
 *
 * 比對表：01.各體係專案耗時統計
 * 4) 只處理「序(B欄)為數字」的資料列
 * 5) 當 01.A欄(前三碼) == 上述彙總的 key 時
 * 6) 將總耗時 ÷ 7，四捨五入到小數點第一位後，寫入 01.E 欄（總天數）
 *
 * 額外：
 * - 若「來源列未被計入耗時」則列印並輸出明細：
 *   (1) 專案空白
 *   (2) 耗時(I)非數字
 *   (3) 非IT、Z找不到 → 但會被算入 ITG（不算 skipped，改列 ITG 明細）
 *   (4) 非IT 且 Z 有，但 Z.體係別(C)前三碼空白（會印出Z體係別原始值與取前三碼結果）
 *   (5) IT 但 專案前三碼空白（極少見，通常專案長度不足）
 *
 * 注意：
 * - 字串完全一致（不做 trim、不轉換）
 * - 若目標表 A 欄空白或沒對到來源，E 欄會清空
 */


XXXXX////總件數_02_各專案類型耗時統計

來源表：耗用工時_2025
依 申請單位（D 欄） 及 專案(A欄)前10碼且有IT開頭 分組
加總申請單位（D 欄） 及 專案(A欄)前10碼且有IT開頭 件數

比對表：03_各部室專案耗用工時
只處理「序（B 欄）為數字」的資料列
比對 申請部門（C 欄），字串完全一致（不做 trim、不轉換）

寫入結果：03_各部室專案耗用工時
加總件數
寫入 D 欄（需求單總數）


////////////////2025需求提單 比對出專案類型

/**
 * 第一段
 * 來源表：2025需求提單
 * - E欄(2025年需求單號) 可能一格含多組 IT 開頭代碼 → 逐一拆解
 * - 每組代碼取前10碼(IT10)
 * - IT10 ->「2025年專案類型」(D欄) 建立對照
 *
 * 目標表：耗用工時_2025
 * - 若 A欄(專案) 以 IT 開頭 → 取前10碼(IT10)
 * - 以 IT10 比對來源，命中則把「2025年專案類型(D欄)」寫回 J欄(最終專案類別)
 *
 * 第二段（你最新規則）
 * - 不要只取前10碼（用完整 A 欄字串比對）
 * - 「只要 J欄(最終專案類別) 還空白」：
 *   若「耗用工時_2025.A(專案)」字串完全等於「Z_設定檔.A(專案)」
 *   → 取「Z_設定檔.D(專案類型)」寫回「耗用工時_2025.J(最終專案類別)」
 *
 * 仍比對不到：
 * - 同一個「耗用工時_2025.A(專案)」只輸出到 X_Error（去重，只輸出專案值）
 *
 * 注意：
 * - 字串完全一致（不做 trim、不轉換）
 */


////////////////_總工時_04_資管處耗用工時統計

/**
 * 來源表：耗用工時_2025
 * - 依 G欄(用戶)取第3碼到第8碼(共6碼) 及 K欄(最終體係別) 分組
 * - 同一組內，加總 I欄(耗時)
 * - 當 K欄(最終體係別) == Z_設定檔.K欄(最終體係別) 時，取出 Z_設定檔.L欄(體係別名稱)
 *
 * 比對表：04_資管處耗用工時統計
   0)  把 04 的交叉格在寫入前先清空
 * 1) 以 04.D(業代) + 04.I4~P4(體係別名稱表頭) 交叉比對
 *    == 耗用工時_2025.G(用戶取第3~8碼) + K欄(最終體係別) 分組
 *    （字串完全一致、不 trim、不轉換）
 
 * 2) 命中則把「加總 I欄(耗時)」填入對應交叉格
  *  - 加總耗時 ÷ 7
 * - 四捨五入到小數點第一位
  *    - 資料列：該業代所在列（第5列起）
 *    - 資料欄：該體係別名稱所在欄（第4列為表頭，I~P）

 *
 * 額外：

		  
	   1.請加總耗用工時_2025.I欄(耗時)等於多少,加總耗時 ÷ 7 ,四捨五入到小數點第一位
	     
	   2.請加總 04_資管處耗用工時統計對應交叉格.


       3.完全比對不到/無法納入統計的來源列，輸出到 X_Error（去重）
 *    - 耗用工時_2025.A(專案) / J(最終專案類別) / I(耗時) / 原因 / 補充
 */
 
        3.請輸入一張:「業代 × 體係別 × 耗時明細表
 
 
        1.若有耗用工時_2025.G欄(用戶)未被加總請顯示出來() 
	   
	   耗用工時_2025.A欄(專案) 、耗用工時_2025.G欄(用戶)、耗用工時_2025.K欄(最終體係別)
	   
	   2.若有04_資管處耗用工時統計.D欄(業代)未被加總請顯示出來 
	      耗用工時_2025.A欄(專案) 、耗用工時_2025.G欄(用戶)、耗用工時_2025.K欄(最終體係別)
 
 
 
 	   4.若加總耗用工時_2025.I欄(耗時) 不等於 04_資管處耗用工時統計對應交叉格.
 	   3.請輸入一張:「業代 × 體係別 × 耗時明細表
 
 ///// Z_設定檔_申請單位

/**
 * 規則：
 * 1) 當「Z_設定檔」A(專案) ==「耗用工時_2025」A(專案) 時
 *    -> 將「Z_設定檔」B(申請單位) 有值的回寫入「耗用工時_2025」D(申請單位)
 *
 * 2) 若「耗用工時_2025.A(專案)」D(申請單位) 有仍為空的
 *    -> 印出（Logger）+ 輸出到工作表  X_Error
 *
 * 3) 若「耗用工時_2025」某列專案(A) 在「Z_設定檔」不存在
 *    -> 不異動（不改 D 欄）
 *
 * 備註：
 * - 字串完全一致（不做 trim、不轉換）
 * - Z_設定檔 同一專案(A) 若多筆，採「第一筆」為準
 */
 
 
 /////  Z_最終專案類別
/**
 * 第一段
 * 來源表：2025需求提單
 * - E欄(2025年需求單號) 可能一格含多組 IT 開頭代碼 → 逐一拆解
 * - 每組代碼取前10碼(IT10)
 * - IT10 ->「2025年專案類型」(D欄) 建立對照（同一 IT10 多筆取第一筆）
 *
 * 目標表：耗用工時_2025
 * - 先清空 J欄(最終專案類別)
 * - 若 A欄(專案) 以 IT 開頭 → 取前10碼(IT10)
 * - 以 IT10 比對來源，命中則把「2025年專案類型(D欄)」寫回 J欄
 *
 * 第二段
 * - 不取前10碼（用完整 A 欄字串比對）
 * - 只要 J 還空白：
 *   若 耗用工時_2025.A == Z_設定檔.A（字串完全一致）
 *   → 取 Z_設定檔.D(專案類型) 寫回 耗用工時_2025.J
 *
 * 仍比對不到：
     Z_設定檔.D(專案類型) 打一個X
 * - 同一個 耗用工時_2025.A 只輸出到 X_Error（去重，只輸出專案值）
 *
 * 注意：
 * - 字串完全一致（不做 trim、不轉換）
 */
 
 
 
 /**
 * 【Prompt 紀錄】
 *
 * Apps Script 規則：
 *
 * 第一段
 * 0) 比對「耗用工時_2024」A欄前10碼 ∈ 「工作表9」C欄(定版)
 *    先統計「命中資料列」共有多少筆（hitRowCount） 及加總其I欄(耗時)
 *
 * 1) 針對「命中資料列」再做三種分組統計：
 *    注意：你的描述強調「以 A欄前10碼為母體」去看其對應欄位的群組，
 *    也就是「同一個 A前10碼」即使在耗用工時_2024 出現多列，會被視為同一筆母體。
 *
 *    1-1) 以「A前10碼」為單位，取該 A前10碼 對應的 L欄(最終體係代碼) 作為群組值
 *         => 統計：各 L 值底下，有多少個「不同的 A前10碼」
 *         => 統計：各 L 值底下，加總其I欄(耗時)且將加總後的總額除以7,且四捨五入到第一位
 *
 *    1-2) 以「A前10碼」為單位，取該 A前10碼 對應的 J欄(最終專案類別) 作為群組值
 *         => 統計：各 J 值底下，有多少個「不同的 A前10碼」
 *         => 統計：各 J 值底下，加總其I欄(耗時)且將加總後的總額除以7,且四捨五入到第一位
 *
 *    1-3) 以「A前10碼」為單位，取該 A前10碼 對應的 D欄(申請單位) 作為群組值
 *         => 統計：各 D 值底下，有多少個「不同的 A前10碼」
 *         => 統計：各 D 值底下，加總其I欄(耗時)且將加總後的總額除以7,且四捨五入到第一位
 *
 * 輸出到：20241011
 * - 會同時輸出：
 *   a) 命中資料列筆數（hitRowCount）
 *   b) 命中 A前10碼「去重後」的筆數（hitA10CountDistinct） 及各對應的加總為多少
 *   c) 三張分組統計表（以「不同 A前10碼」計數）
 */
 
 
 
/**
 * 【Prompt 紀錄】
 *
 * X_X_比對各部室資料回寫2024全年度
 *
 * Apps Script 規則：
   手動去清單 2024全年度.I(需求單總件數 2024全年度.J(總天數)
 * 第一段
 * 當「0109各部室工時」B欄(申請部門) == 「2024全年度」D欄(申請部門) 時：
 *  - 將 0109各部室工時.C(需求單總數) 回寫到 2024全年度.I(需求單總件數)
 *  - 將 0109各部室工時.D(總天數(B)) 回寫到 2024全年度.J(總天數)
 *  - 比對到的：0109各部室工時.L = "Done"
 *  - 比對不到的：0109各部室工時.L = "比對不到"
 *
 * 假設：
 * - 兩張表皆第 1 列為表頭，資料自第 2 列開始
 * - 字串比對：trim 後比對（如要「完全一致不 trim」我可幫你改）
 */


/** * X_X_比對出處資料回寫2024全年度（31~63 加總 -> 70~85 回寫） 
 * * * 【Prompt 紀錄】 * Apps Script 規則： 
 * * * 第一段 * 只處理「2024全年度」第 31~63 列（含）作為「明細來源」 
 * * - 以 2024全年度.D(申請部門) 去比對 Z_處部別.B(申請部門) 
 * * - 命中則取得 Z_處部別.C(申請處別) * - 以「申請處別」分組後： 
 * * 1) 加總該組的 2024全年度.E(需求單總件數) 
 * * 2) 加總該組的 2024全年度.F(總天數) 
 * * 3) 再用「申請處別」去比對「2024全年度」第 70~85 列（含）的 D 欄
 *  * - 命中：回寫該列 E、F（該列視為處別彙總列）
 * 
 *  * * 另外： 
 * * - 若「申請部門」在 Z_處部別 找不到對應 
 * * 或「申請處別」在 2024全年度(70~85).D 找不到彙總列 * 則輸出到「處_Error」：D(申請部門/申請處別)、E(需求單總件數)、F(總天數)、原因
 * 
 *  * * 備註：
 *  * - 比對採用 trim 後比對（如要完全一致不 trim 可改） 
 * 
 * */


/** * X_X_比對出處資料回寫2025全年度03_各部室專案耗用工時

 * * * 【Prompt 紀錄】 * Apps Script 規則： 
 * * * 第一段 * 
 ]   處理「03_各部室專案耗用工時」C欄作為「明細來源」 
 
 * * - 以03_各部室專案耗用工時」C欄(申請部門) 去比對 Z_處部別.B(申請部門) 
 * * - 命中則取得 Z_處部別.C(申請處別) * - 以「申請處別」分組後： 
 * * 1) 加總該組的 03_各部室專案耗用工時.D欄(需求單總件數) 
 * * 2) 加總該組的 203_各部室專案耗用工時.E欄(總天數) 
 * * 3) 再用「申請處別」去比對「「031_各處別專案耗用工時」.C欄
 *  * - 命中：回寫該列 D、E（該列視為處別彙總列）
 * 
 *  * * 另外： 
 * * - 若「申請部門」在 Z_處部別 找不到對應 
 * * 或「申請處別」在 03_各部室專案耗用工時.C 找不到
     彙總列 * 則輸出到「處_Error」：C(申請部門/申請處別)、D(需求單總件數)、E(總天數)、原因
 * 
 *  * * 備註：
 *  * - 比對採用 trim 後比對（如要完全一致不 trim 可改） 
 * 
 * */
 \
 
/**
 * 算出與前期比較
 *
 * 【Prompt 紀錄】
 * Apps Script 規則：
 *
 * 第一段：算出需求單總件數/總天數/參考成本 前期比較成長率
 * 當 031_各處別專案耗用工時.C欄(申請處別) = 031_各處別專案耗用工時.M欄(申請處別) 時：
 * - 本期：D(需求單總件數)；前期：N(需求單總件數)；比較結果回寫：H
 * - 本期：E(總天數)；前期：O(總天數)；比較結果回寫：I
 * - 本期：G(參考成本)；前期：P(參考成本)；比較結果回寫：J
 * 四捨五入到小數點第 1 位
 *
 * 若沒有對應到（C≠M 或前期=0 無法比較），則產出 031_error（記錄 C 欄申請處別）
 */
 

/**
 * 04資管處耗時統計：所有體係、小計及總計統計、算出所有體係工作負載量
 *
 * 【ChatGPT Prompt 紀錄】
 * Apps Script 規則：
 *
 * 來源：04_資管處耗用工時統計
 *
 * 第一段：資料列「所有體係」統計
 * 1) 只處理 D 欄為 Z 開頭且不空白的資料列
 * 2) H 欄（所有體係）＝ I ～ P 欄加總，四捨五入至小數點第 1 位
 * 3) F 欄需與 H 欄相同，F 欄回寫為 H 欄的值
 *
 * 第二段：小計與所有總計（僅回填 E ～ P）
 * 1) D 欄為 Z 開頭且不空白 → B 欄依序填入 1,2,3…；否則 B 欄清空
 * 2) 當 C 欄＝「小計(天)」：
 *    - 加總「上一個小計 / 所有總計之後」至「小計前一列」的資料
 *    - 將加總結果回填至 E ～ P 欄（四捨五入至小數點第 1 位）
 * 3) 當 C 欄＝「所有總計(天)」：
 *    - 加總所有資料列
 *    - 排除 C 欄為「小計(天)」與「所有總計(天)」的列
 *    - 將加總結果回填至 E ～ P 欄（四捨五入至小數點第 1 位）
 *
 * 第三段：統一重算所有體係（避免 H / F 不一致）
 * 1) 針對以下列別重新計算：
 *    - D 欄為 Z 開頭且不空白的資料列
 *    - C 欄為「小計(天)」或「所有總計(天)」的列
 * 2) H 欄（所有體係）＝ I ～ P 欄加總，四捨五入至小數點第 1 位
 * 3) F 欄一律回寫為 H 欄的值，確保 F 與 H 完全一致
 *
 * 第四段：計算 G 欄（所有體係工作負載量）
 * 1) 適用列別：
 *    - D 欄為 Z 開頭且不空白的資料列
 *    - C 欄為「小計(天)」或「所有總計(天)」的列
 * 2) 計算公式：G = F / E
 * 3) 四捨五入至小數點第 1 位，並以百分比格式顯示
 */
 
 
 
/**
 * 04資管處耗時HRM 工作日數回寫
 *
 * 【ChatGPT Prompt 紀錄】
 *  Apps Script 規則：
 *   當 資管處HRM工作日數.D欄(業代) 對應 04_資管處耗用工時統計.D欄(業代) 時,
 *   將 資管處HRM工作日數.F欄(HRM工作日數) 回寫到對應的04_資管處耗用工時統計.E欄(所有體係(HRM)工作日數(A))
 */
 


 /**
 * 
 *
 * 【ChatGPT Prompt 紀錄】
 * Apps Script 規則：
 * 來源檔"
 * 當耗用工時_2025.J欄(最終專案類別)為"資訊系統維運工作"時,以 耗用工時_2025.A欄(專案)為分組統計,
 * 然後加總耗用工時_2025.I欄(耗時)
 *
 * 再用耗用工時_2025.A欄(專案)去比對 確認_A.A欄(專案)
 * 若比對到,則要加總後的耗用工時_2025.I欄(耗時) 回寫至 確認_A.(B欄)總工時
 *
 * 但加總後的工時要除以7,且要四捨五入第一位.
 */
 
/**
 * 
 *
 * 【ChatGPT Prompt 紀錄】
 請把prompt 改成你會產出的作法
 不要動到其他欄位公式
 
 
 * Apps Script 規則：
 
/**
 *
 * 【ChatGPT Prompt 紀錄｜實際產出作法】
 *
 * 不要動到其他欄位公式
 *
 * Apps Script 規則說明：
 *
 * 來源檔：2026年度需求提單
 * 來源檔網址：
 * https://docs.google.com/spreadsheets/d/1BPjoPRs-WcxSQCaDvwa9UFIgnhBaVr3LD-UsqhKiZz0/edit
 *
 * 一、資料篩選條件
 * - 僅處理「2026年度需求提單」中
 *   B欄（專案類型）＝「年度提案」的資料列
 * - 不進行任何與「年度專案_預估工時」既有資料的比對或查詢
 *
 * 二、資料回傳行為（整批覆蓋）
 * - 每次執行時：
 *   1) 先清空「年度專案_預估工時」第 2 列起的資料內容
 *      （僅清空指定回寫欄位，其餘欄位與公式不處理）
 *   2) 再依序將符合條件的來源資料整批寫入
 *   3) 沒有必填欄位,值就寫,沒有也沒有關係
 *
 * 三、回傳欄位對應規則
 * - 2026年度需求提單.A欄（提案序）→ 年度專案_預估工時.B欄（提案序）
 * - 2026年度需求提單.J欄（體係）  → 年度專案_預估工時.C欄（體係）
 * - 2026年度需求提單.K欄（提案處部）→ 年度專案_預估工時.D欄（部門別）
 * - 2026年度需求提單.I欄（專案名稱）→ 年度專案_預估工時.G欄（具體專案）
 * - 2026年度需求提單.D欄（需求單號）→ 年度專案_預估工時.J欄（需求單號）
 *
 * 四、異常處理規則
 * - 若來源資料列無法寫入的
 *   → 將異常原因與列號記錄至「年度專案Error」資料表
 *
 * 五、統計輸出 ERRor
 * - 執行完成後，需統計並回報：
 *   1) 符合「年度提案」條件的來源筆數
 *   2) 實際成功寫入「年度專案_預估工時」的筆數
 *   3) 因資料缺漏而未寫入的筆數（此版規則固定為 0）
 *   4) 異常紀錄筆數（年度專案Error）
 *
 */


/**X_只更新需求單是空白及抄寫未存在的年度專案
 *
 * 【ChatGPT Prompt 紀錄｜實際產出作法】
 *
 * 不要動到其他欄位公式
 *
 * Apps Script 規則說明：
 *
 * 來源檔：2026年度需求提單
 * 來源檔網址：
 * https://docs.google.com/spreadsheets/d/1BPjoPRs-WcxSQCaDvwa9UFIgnhBaVr3LD-UsqhKiZz0/edit
 *
 * 一、資料篩選條件
 * - 僅處理「2026年度需求提單」中
 *   B欄（專案類型）＝「年度提案」的資料列
 *
 * 二、比對規則
 * - 比對 2026年度需求提單.A欄（提案序） = 年度專案_預估工時.B欄（提案序）
 *
 *   若 來源A(提案序) 不存在 目的B(提案序)
 *   → 新增寫入（只寫 B/C/D/G/J，其餘欄位不動）
 *
 *   若 來源A(提案序) 已存在 目的B(提案序)
 *      且目的J（需求單號）為空白或是XXX開頭時
 *   → 只更新 目的J(需求單號) = 來源D(需求單號)
 *
 * 三、回傳欄位對應規則（僅新增時）
 * - 來源A（提案序）→ 目的B（提案序）
 * - 來源J（體係）  → 目的C（體係）
 * - 來源K（提案處部）→ 目的D（部門別）
 * - 來源I（專案名稱）→ 目的G（具體專案）
 * - 來源D（需求單號）→ 目的J（需求單號）
 *
 * 四、異常處理規則
 * - 若來源資料列無法寫入的
 *   → 將異常原因與列號記錄至「年度專案Error」資料表
 *
 * 五、統計輸出 ERRor
 * - 執行完成後，需統計並回報：
 *   1) 符合「年度提案」條件的來源筆數
 *   2) 實際成功寫入（新增 + 更新J）筆數
 *   3) 因資料缺漏而未寫入的筆數（此版規則固定為 0）
 *   4) 異常紀錄筆數（年度專案Error）
 *
 */
 
 


依附件 申請欄位單位,依參考成本,

產出圓餅圖


根據您的 PDF 文件內容，提取了「申請體系」與「參考成本」的數據，並製作了一個互動式的 HTML 圓餅圖。


圓餅圖設定。這次做了以下調整：

新增數據標籤：直接在圓餅圖的區塊上顯示「參考成本」的金額與百分比（金額較小時僅顯示百分比，以免擁擠）。

調整配色：換了一組更為鮮明、對比度更高的專業配色方案。

金額格式化：圖表上的金額已加上千分位逗號，方便閱讀。



!!!11

智慧標籤定位：系統會自動判斷區塊大小。

大區塊（佔比 > 5%）：文字顯示在圓餅圖內部，字體為白色。

小區塊（佔比 < 5%）：文字顯示在圓餅圖外部，字體為深色，避免擠在一起。

完整數字顯示：移除了縮寫，現在顯示完整的金額（如 $7,445,000）。

移除日期：移除了底部的生成日期。

放大圖表：增加了圖表的高度，讓視覺效果更震撼。




/**
 * ===1.統計2026年度專案耗時===
 *
 * ## 【ChatGPT Prompt 紀錄】
 * - 請在程式碼開頭保留 ChatGPT Prompt 紀錄（用 markdown 語法為註記）
 * - 使用台灣繁體中文
 * - 不要動到其他欄位公式
 * - 要用在 Apps Script
 *
 * X_2026年度專案耗時（最新版：用 I 欄需求單號比對）
 *
 * ## 【實際產出作法】
 * - 來源 Spreadsheet：年度專案_預估工時（ID：1NCjox4UP04hVNn2H_BTqkXsFykq-NCgwO277wSD7fTI）
 * - 來源工作表：年度專案_預估工時
 * - 目標 Spreadsheet：Y_2026年度專案耗時（ID：1C-CHOQQS05121FWYuIrPBBnqVqwdAMkoEKMubiTZu4g）
 * - 目標工作表：Y_2026年度專案耗時
 * - 錯誤輸出工作表：年度專案Error（建立於來源 Spreadsheet，若不存在則建立；每次覆蓋輸出）
 *
 * ## 【欄位定義（1-based）】
 * ### 來源：年度專案_預估工時
 * - B(2)   提案序號
 * - G(7)   專案名稱
 * - J(10)  需求單號（篩選/比對 key）
 * - AI(35) 總時數（回寫）
 * - AJ(36) 總天數（回寫）
 *
 * ### 目標：Y_2026年度專案耗時
 * - D(4)  耗時（加總欄位，不去重）
 * - I(9)  需求單號（比對 key）
 *
 * ## 【規則】
 * 0) 每次要處理之前把來源 AI（總時數）及 AJ（總天數）欄清空
 * 01) 年度專案_預估工時 資料從第三列開始處理
 * 02) 只要是 J 欄為 IT 或 XX 開頭的都要拆解（支援多種分隔符號），
 *     然後把拆解後各需求單號在目標表加總的耗時（D，不去重）再「總加總」，
 *     回寫至 年度專案_預估工時.AI（總時數）及 年度專案_預估工時.AJ（總天數）
 *
 * 1) 一般情境：只處理來源 J 欄，在目標 I 欄存在的資料列（比對前皆 trim）
 * 2) 比對 key：trim(來源 J) = trim(目標 I)
 * 3) 命中：
 *    - 依目標 I 分組，加總目標 D（耗時，不去重）= 總時數
 *    - 回寫來源 AI（總時數）
 *    - AJ = round(AI/6)
 * 3-1) 請也列出存在 Y_2026年度專案耗時.I欄(需求單號) 但對應不到 年度專案_預估工時.J(需求單號)
 *      （此處會把「拆解後的需求單號」也納入比對）
 * 4) 未命中：輸出到「年度專案Error」(J, G, B)
 * 5) 回寫限制：僅回寫來源 AI、AJ（一次寫入兩欄，避免只寫到 AI）
 * 6) 執行完需 Logger.log 統計
 */


===2.統計依角色==

/**
 * /**2.統計依角色==
 *
 * ## 【ChatGPT Prompt 紀錄】
 * - 請在程式碼開頭保留 ChatGPT Prompt 紀錄（用 markdown 語法為註記）
 * - 使用台灣繁體中文
 * - 不要動到其他欄位公式
 * - 要用在 Apps Script
 *
 * ## X_2026年度專案耗時（依角色統計：用 I 欄需求單號比對）
 *
 * ## 【實際產出作法】
 * - 來源 Spreadsheet：年度專案_預估工時（ID：1NCjox4UP04hVNn2H_BTqkXsFykq-NCgwO277wSD7fTI）
 * - 來源工作表：年度專案_預估工時
 *
 * - 角色對應表 Spreadsheet：1eCFMJYwduUShzWSIoUcvMmEjwufc6wXVHOGglWq0fsU
 * - 角色對應表工作表：角色對應表
 *
 * - 目標 Spreadsheet：Y_2026年度專案耗時（ID：1C-CHOQQS05121FWYuIrPBBnqVqwdAMkoEKMubiTZu4g）
 * - 目標工作表：Y_2026年度專案耗時
 *
 * - 錯誤輸出工作表：年度專案Error（建立於來源 Spreadsheet，若不存在則建立；每次覆蓋輸出）
 *
 * ## 【欄位定義（1-based）】
 * ### 來源：年度專案_預估工時
 * - B(2)   提案序號
 * - G(7)   專案名稱
 * - J(10)  需求單號（篩選/比對 key）
 * - W ~ AG（回寫：依角色回寫工時天數）
 *
 * ### 目標：Y_2026年度專案耗時
 * - E(5)  用戶取第3~8碼（業代/用戶欄，不含前綴00與姓名）
 * - D(4)  耗時（加總欄位，不去重）
 * - I(9)  需求單號（比對 key）
 *
 * ### 角色對應表：角色對應表
 * - B(2)  業代（例：ZZ0074、Z00056）
 * - C(3)  業代角色（例：SD）
 *
 * ## 【規則】
 * 0) 每次處理前先清空來源 W ~ AG 欄
 * 01) 年度專案_預估工時 資料從第 3 列開始處理
 * 02) 來源 J 欄若為 IT 或 XX 開頭，需拆解（支援多分隔符號），以拆解後的需求單號集合去目標表找耗時
 * 03) 命中邏輯：
 *    - 以「需求單號(目標I) + 角色(由目標E萃取第3~8碼→對應表C)」分組
 *    - 加總目標 D（不去重）
 *    - 將總時數 / 6 四捨五入取整數（視為天數）
 *    - 回寫到來源該列的 W ~ AG，欄位對應依「來源第 2 列 W ~ AG 的表頭文字」= 角色名稱
 * 3-1) 列出存在目標 I 但來源 J（含拆解後）找不到的「專案名稱(G)」及業代還有角色
 * 4) 未命中：輸出到「年度專案Error」(J, G, B)
 * 5) 回寫限制：僅回寫來源 W ~ AG（一次整段寫入）
 * 6) 執行完需 Logger.log 統計
 */
 
 
 ==資管處HRM2026年總人力天數==
 /**
 * /**取得HRM 人數==
 *
 * ## 【ChatGPT Prompt 紀錄】
 * - 請在程式碼開頭保留 ChatGPT Prompt 紀錄（用 markdown 語法為註記）
 * - 使用台灣繁體中文
 * - 不要動到其他欄位公式
 * - 要用在 Apps Script
 *
 * ## 【實際產出作法】
 * - 來源 Spreadsheet：1eCFMJYwduUShzWSIoUcvMmEjwufc6wXVHOGglWq0fsU
 * - 來源工作表：HRM人力
 *
 * - 角色對應表 Spreadsheet：1eCFMJYwduUShzWSIoUcvMmEjwufc6wXVHOGglWq0fsU
 * - 角色對應表工作表：角色對應表
 *
 * - 目標 Spreadsheet：171yb5SUBCHuSmKNgkJ6nf8Fq1W99_WM0iNfOdD8UlwY
 * - 目標工作表：專案人力表
 *
 * - 錯誤輸出工作表：Error（建立於目標 Spreadsheet，若不存在則建立；每次覆蓋輸出）
 *
 * ## 【欄位定義（1-based）】
 * ### 來源：HRM人力
 * - D(4)  業代(比對 key)
 * - F(6)  HRM工作日數
 *
 * ### 目標：專案人力表
 * - C ~ M（回寫：依角色回寫工時天數）
 *
 * ### 角色對應表：角色對應表
 * - B(2)  業代（例：ZZ0074、Z00056）
 * - C(3)  業代角色（例：SD）
 *
 * ## 【規則】
 * 0) 每次處理前先清空目標「第 4 列」的 B ~ M（只清這一列）
 * 01) 目標資料只處理第 4 列
 *    - 回寫到目標第 4 列的 C ~ M，欄位對應依「目標第 3 列 C ~ M 的表頭文字」= 角色名稱
 * 02) 最後加總 C4 ~ M4 總數於 B4
 * 3-1) 列出存在來源 D 但目標不不存在的角色
 * 4) 未命中：輸出到「Error」(D,F)
 * 5) 回寫限制：僅回寫目標 C ~ M（一次整段寫入）
 * 6) 執行完需 Logger.log 統計
 */



 
/**
 * /**取得策略屋/年度專案工時==
 *
 * ## 【ChatGPT Prompt 紀錄】
 * - 請在程式碼開頭保留 ChatGPT Prompt 紀錄（用 markdown 語法為註記）
 * - 使用台灣繁體中文
 * - 不要動到其他欄位公式
 * - 要用在 Apps Script
 *
 * ## 【實際產出作法】
 * - 來源 Spreadsheet：1NCjox4UP04hVNn2H_BTqkXsFykq-NCgwO277wSD7fTI
 * - 來源工作表：年度專案_預估工時
 *
 * - 目標 Spreadsheet：171yb5SUBCHuSmKNgkJ6nf8Fq1W99_WM0iNfOdD8UlwY
 * - 目標工作表：專案人力表
 *
 * - 錯誤輸出工作表：Error（建立於目標 Spreadsheet，若不存在則建立；每次覆蓋輸出）
 *
 * ## 【欄位定義（1-based）】
 * ### 來源：年度專案_預估工時
 * - A(1)  專案類別（例：策略屋提案、年度提案）
 * - K ~ U（預估：加總來源欄位；依來源第2列表頭）
 * - W ~ AG（實際：加總來源欄位；依來源第2列表頭）
 *
 * ### 目標：專案人力表
 * - A 欄：分類名稱（例：策略屋專案預估天數、年度專案預估天數、策略屋專案實際天數、年度專案實際耗時）
 * - 第 3 列：C ~ N（表頭：角色名稱）
 * - 指定區塊（第 5 列至第 8 列）：C ~ N（回寫：依角色名稱回寫總天數）
 * - B 欄：加總欄（= C ~ N 加總）
 *
 * ## 【規則】
 * 0) 每次處理前先清空目標「第 5 列至第 8 列」的 B ~ N（只清這個區間）
 * 01) 來源資料從第 3 列開始處理
 *
 * === 預估區塊 Start（K~U）===
 * A) 策略屋提案預估彙總
 * - 來源：A=策略屋提案；加總 K~U
 * - 目標列：A=策略屋專案預估天數
 *
 * B) 年度提案預估彙總
 * - 來源：A=年度提案；加總 K~U
 * - 目標列：A=年度專案預估天數
 * === 預估區塊 End ===
 *
 * === 實際區塊 Start（W~AG）===
 * A) 策略屋提案實際彙總
 * - 來源：A=策略屋提案；加總 W~AG
 * - 目標列：A=策略屋專案實際天數
 *
 * B) 年度提案實際彙總
 * - 來源：A=年度提案；加總 W~AG
 * - 目標列：A=年度專案實際耗時
 * === 實際區塊 End ===
 *
 * 欄位對應（四種彙總皆相同）：
 * - 以來源第 2 列(各區塊欄位範圍的表頭) ↔ 目標第 3 列 C~N 表頭
 * - 表頭字串比對：trim 後完全一致
 * - 命中後：把加總結果寫入目標列對應欄位 C~N
 * - 該列最後：加總該列 C~N 回寫至同列 B
 *
 * 3-1) 列出「來源表頭存在，但目標表頭(C~N)不存在」的表頭清單（Logger + Error）
 * 4) 若來源 A 為策略屋提案/年度提案，但該區塊全空/非數字：輸出到 Error（列號、原因、區塊）
 * 5) 回寫限制：僅回寫目標指定列的 C~N 與同列 B（一次整段寫入；逐列寫入但單列一次寫完）
 * 6) 執行完需 Logger.log 統計
 */
 
 
 
 剩餘可用天數
/**
 * /**取得 剩餘可用天數==
 *
 * ## 【ChatGPT Prompt 紀錄】
 * - 請在程式碼開頭保留 ChatGPT Prompt 紀錄（用 markdown 語法為註記）
 * - 使用台灣繁體中文
 * - 不要動到其他欄位公式
 * - 要用在 Apps Script
 *
 * ## 【實際產出作法】
 * - 目標 Spreadsheet：171yb5SUBCHuSmKNgkJ6nf8Fq1W99_WM0iNfOdD8UlwY
 * - 目標工作表：專案人力表
 * - 錯誤輸出工作表：Error（建立於目標 Spreadsheet，若不存在則建立；每次覆蓋輸出）
 *
 * ### 目標：專案人力表
 * - A 欄：分類名稱
 *   （例：策略屋專案預估天數、年度專案預估天數、策略屋專案實際天數、年度專案實際耗時、資管處HRM總人力天數）
 * - 第 3 列：C ~ N（表頭：角色名稱）
 *
 * ## 【規則】
 * 0) 每次處理前先清空目標「第 9 列」的 B ~ N（只清這一列）
 *
 * === 剩餘可用天數（第9列，B~N）===
 * 1) 策略屋專案已使用天數（依角色欄位 B~N）=
 *    max(策略屋專案預估天數, 策略屋專案實際天數)
 *
 * 2) 年度專案已使用天數（依角色欄位 B~N）=
 *    max(年度專案預估天數, 年度專案實際耗時)
 *
 * 3) 剩餘可用天數（第9列，B~N）=
 *    資管處HRM總人力天數 - (策略屋已使用 + 年度已使用)
 *
 * 4) 將結果寫回第 9 列對應欄位
 * 5) B9 = SUM(C9~N9)
 * 6) 執行完需 Logger.log 統計
 */